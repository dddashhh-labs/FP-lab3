-- PointGenerator.lean
import Interpolation.Types

namespace Interpolation.PointGenerator
open Interpolation

-- Генератор точек для интерполяции (отдельный компонент!)
structure Generator where
  start : Float
  stop : Float
  step : Float
  step_positive : 0 < step
deriving Repr

-- Доказательство корректности генератора
theorem generator_produces_sorted (g : Generator) :
  ∀ points, points = generate g → IsSorted (points.map Point.mk · 0) := by
  sorry

-- Генерация последовательности X координат
def generate (g : Generator) : List Float :=
  let rec aux (current : Float) (acc : List Float) : List Float :=
    if current > g.stop then acc.reverse
    else aux (current + g.step) (current :: acc)
  aux g.start []

-- Генератор для первого окна (много точек)
def generateFirst (points : List Point) (step : Float) (h : 0 < step) : List Float :=
  match points.head?, points.getLast? with
  | some first, some last =>
    generate { start := first.x, stop := last.x, step := step, step_positive := h }
  | _, _ => []

-- Генератор для среднего окна (одна центральная точка)
def generateMiddle (points : List Point) : Option Float :=
  let mid := points.length / 2
  points[mid]?.map (·.x)

-- Генератор для последнего окна (оставшиеся точки)
def generateLast (points : List Point) (lastOutput : Float) (step : Float) (h : 0 < step) : List Float :=
  match points.getLast? with
  | some last =>
    generate { 
      start := lastOutput + step, 
      stop := last.x, 
      step := step, 
      step_positive := h 
    }
  | none => []

end Interpolation.PointGenerator
